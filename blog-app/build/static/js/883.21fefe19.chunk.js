"use strict";(self.webpackChunkblog_app=self.webpackChunkblog_app||[]).push([[883],{1883:(e,t,i)=>{i.r(t),i.d(t,{default:()=>J});var l=i(5043),n=i(2768),s=i(2097),a=i(6647),r=i(3969),o=i(5895),c=i(172),d=i(1449),h=i(3023),u=i(1911),x=i(8776),A=i(1438),g=i(6154),p=i(5877),j=i(2911),m=i(6529),f=i(5267),v=i(5362),y=i(1773),C=i(2950),k=i(4990),b=i(3437),w=i(6727),S=i(621),I=i(848),W=i(1922),z=i(548),L=i(3442),B=i(661),H=i(267),T=i(3697),P=i(9430),U=i(5714),q=i(6699),N=i(3974),$=i(2388),R=i(5440),_=i(1491),F=i(5297),O=i(312),D=i(9073),E=i(6127),M=i(3256),G=i(832),V=i(5019),X=i(579);function Z(e){let{editor:t}=e;const[i,r]=l.useState(!1),[o,c]=l.useState(""),[d,j]=l.useState(!1),[f,v]=l.useState(""),[y,C]=l.useState(!1);if(!t)return null;return(0,X.jsxs)(A.A,{direction:"row",spacing:1,sx:{mb:1,flexWrap:"wrap"},children:[(0,X.jsx)(m.A,{title:"Undo",children:(0,X.jsx)("span",{children:(0,X.jsx)(a.A,{onClick:()=>t.chain().focus().undo().run(),disabled:!t.can().undo(),children:(0,X.jsx)(_.A,{})})})}),(0,X.jsx)(m.A,{title:"Redo",children:(0,X.jsx)("span",{children:(0,X.jsx)(a.A,{onClick:()=>t.chain().focus().redo().run(),disabled:!t.can().redo(),children:(0,X.jsx)(F.A,{})})})}),(0,X.jsx)(m.A,{title:"Bold",children:(0,X.jsx)("span",{children:(0,X.jsx)(a.A,{onClick:()=>t.chain().focus().toggleBold().run(),color:t.isActive("bold")?"primary":"default",children:(0,X.jsx)(T.A,{})})})}),(0,X.jsx)(m.A,{title:"Italic",children:(0,X.jsx)("span",{children:(0,X.jsx)(a.A,{onClick:()=>t.chain().focus().toggleItalic().run(),color:t.isActive("italic")?"primary":"default",children:(0,X.jsx)(P.A,{})})})}),(0,X.jsx)(m.A,{title:"Underline",children:(0,X.jsx)("span",{children:(0,X.jsx)(a.A,{onClick:()=>t.chain().focus().toggleUnderline().run(),color:t.isActive("underline")?"primary":"default",children:(0,X.jsx)(U.A,{})})})}),(0,X.jsx)(m.A,{title:"Bullet List",children:(0,X.jsx)("span",{children:(0,X.jsx)(a.A,{onClick:()=>t.chain().focus().toggleBulletList().run(),color:t.isActive("bulletList")?"primary":"default",children:(0,X.jsx)(q.A,{})})})}),(0,X.jsx)(m.A,{title:"Ordered List",children:(0,X.jsx)("span",{children:(0,X.jsx)(a.A,{onClick:()=>t.chain().focus().toggleOrderedList().run(),color:t.isActive("orderedList")?"primary":"default",children:(0,X.jsx)(N.A,{})})})}),(0,X.jsx)(m.A,{title:"Blockquote",children:(0,X.jsx)("span",{children:(0,X.jsx)(a.A,{onClick:()=>t.chain().focus().toggleBlockquote().run(),color:t.isActive("blockquote")?"primary":"default",children:(0,X.jsx)($.A,{})})})}),(0,X.jsx)(m.A,{title:"Code Block",children:(0,X.jsx)("span",{children:(0,X.jsx)(a.A,{onClick:()=>t.chain().focus().toggleCodeBlock().run(),color:t.isActive("codeBlock")?"primary":"default",children:(0,X.jsx)(R.A,{})})})}),(0,X.jsx)(m.A,{title:"Heading 1",children:(0,X.jsx)("span",{children:(0,X.jsxs)(a.A,{onClick:()=>t.chain().focus().toggleHeading({level:1}).run(),color:t.isActive("heading",{level:1})?"primary":"default",children:[(0,X.jsx)(E.A,{fontSize:"small"}),"1"]})})}),(0,X.jsx)(m.A,{title:"Heading 2",children:(0,X.jsx)("span",{children:(0,X.jsxs)(a.A,{onClick:()=>t.chain().focus().toggleHeading({level:2}).run(),color:t.isActive("heading",{level:2})?"primary":"default",children:[(0,X.jsx)(E.A,{fontSize:"small"}),"2"]})})}),(0,X.jsx)(m.A,{title:"Heading 3",children:(0,X.jsx)("span",{children:(0,X.jsxs)(a.A,{onClick:()=>t.chain().focus().toggleHeading({level:3}).run(),color:t.isActive("heading",{level:3})?"primary":"default",children:[(0,X.jsx)(E.A,{fontSize:"small"}),"3"]})})}),(0,X.jsx)(m.A,{title:"Align Left",children:(0,X.jsx)("span",{children:(0,X.jsx)(a.A,{onClick:()=>t.chain().focus().setTextAlign("left").run(),color:t.isActive({textAlign:"left"})?"primary":"default",children:(0,X.jsx)(M.A,{})})})}),(0,X.jsx)(m.A,{title:"Align Center",children:(0,X.jsx)("span",{children:(0,X.jsx)(a.A,{onClick:()=>t.chain().focus().setTextAlign("center").run(),color:t.isActive({textAlign:"center"})?"primary":"default",children:(0,X.jsx)(G.A,{})})})}),(0,X.jsx)(m.A,{title:"Align Right",children:(0,X.jsx)("span",{children:(0,X.jsx)(a.A,{onClick:()=>t.chain().focus().setTextAlign("right").run(),color:t.isActive({textAlign:"right"})?"primary":"default",children:(0,X.jsx)(V.A,{})})})}),(0,X.jsx)(m.A,{title:"Insert Image",children:(0,X.jsx)("span",{children:(0,X.jsx)(a.A,{onClick:()=>r(!0),children:(0,X.jsx)(O.A,{})})})}),(0,X.jsx)(m.A,{title:"Insert Link",children:(0,X.jsx)("span",{children:(0,X.jsx)(a.A,{onClick:()=>j(!0),children:(0,X.jsx)(D.A,{})})})}),(0,X.jsxs)(h.A,{open:i,onClose:()=>r(!1),children:[(0,X.jsx)(u.A,{children:"Insert Image"}),(0,X.jsxs)(x.A,{children:[(0,X.jsx)(g.A,{label:"Image URL",value:o,onChange:e=>c(e.target.value),fullWidth:!0,sx:{mb:2}}),(0,X.jsxs)(s.A,{variant:"outlined",component:"label",fullWidth:!0,disabled:y,children:[y?"Uploading...":"Upload Image",(0,X.jsx)("input",{type:"file",accept:"image/*",hidden:!0,onChange:async e=>{const i=e.target.files[0];if(i)try{C(!0);const e=await(0,n.V)(i);t.chain().focus().setImage({src:e}).run(),r(!1),c("")}catch(l){console.error("Image upload failed:",l),alert("Failed to upload image. Please try again.")}finally{C(!1)}}})]})]}),(0,X.jsxs)(p.A,{children:[(0,X.jsx)(s.A,{onClick:()=>r(!1),children:"Cancel"}),(0,X.jsx)(s.A,{onClick:()=>{o&&(t.chain().focus().setImage({src:o}).run(),r(!1),c(""))},disabled:!o||y,children:"Insert"})]})]}),(0,X.jsxs)(h.A,{open:d,onClose:()=>j(!1),children:[(0,X.jsx)(u.A,{children:"Insert Link"}),(0,X.jsx)(x.A,{children:(0,X.jsx)(g.A,{label:"Link URL",value:f,onChange:e=>v(e.target.value),fullWidth:!0})}),(0,X.jsxs)(p.A,{children:[(0,X.jsx)(s.A,{onClick:()=>j(!1),children:"Cancel"}),(0,X.jsx)(s.A,{onClick:()=>{f&&(t.chain().focus().extendMarkRange("link").setLink({href:f}).run(),j(!1),v(""))},disabled:!f,children:"Insert"})]})]})]})}const J=()=>{const[e,t]=(0,l.useState)([]),[i,m]=(0,l.useState)(!0),[T,P]=(0,l.useState)(""),[U,q]=(0,l.useState)(null),[N,$]=(0,l.useState)({title:"",slug:"",content:"",type:"",tags:"",author:""}),[R,_]=(0,l.useState)({open:!1,message:"",severity:"success"}),[F,O]=(0,l.useState)(!1),D=(0,H.A)(),E=async()=>{m(!0);try{const e={Authorization:`Bearer ${localStorage.getItem("adminToken")}`},i=await n.A.get("/articles",{headers:e});t(i.data),P("")}catch(l){var e,i;P((null===(e=l.response)||void 0===e||null===(i=e.data)||void 0===i?void 0:i.message)||"Failed to fetch posts")}m(!1)};(0,l.useEffect)((()=>{E()}),[]);const M=async e=>{if(window.confirm("Delete this post?"))try{const t={Authorization:`Bearer ${localStorage.getItem("adminToken")}`};await n.A.delete(`/articles/${e}`,{headers:t}),_({open:!0,message:"Post deleted",severity:"success"}),E()}catch(t){_({open:!0,message:"Failed to delete post",severity:"error"})}},G=e=>{const{name:t,value:i}=e.target;let l={...N,[t]:i};"title"!==t||U||(l.slug=V(i)),$(l)},V=e=>e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),J=async e=>{e.preventDefault();const t=ee?ee.getHTML():N.content;try{const e={Authorization:`Bearer ${localStorage.getItem("adminToken")}`},i={...N,content:t,slug:N.slug||V(N.title),tags:N.tags.split(",").map((e=>e.trim())).filter(Boolean),author:N.author||""};if(Object.keys(i).forEach((e=>{""!==i[e]&&void 0!==i[e]||delete i[e]})),!i.author)return void P("Author is required");U?(await n.A.put(`/articles/${U}`,i,{headers:e}),_({open:!0,message:"Post updated",severity:"success"}),q(null),$({title:"",slug:"",content:"",type:"",tags:"",author:""}),O(!1),E()):(await n.A.post("/articles",i,{headers:e}),_({open:!0,message:"Post created",severity:"success"}),$({title:"",slug:"",content:"",type:"",tags:"",author:""}),O(!1),E())}catch(i){_({open:!0,message:"Failed to save post. Please check your input and try again.",severity:"error"})}},K=()=>{q(null),$({title:"",slug:"",content:"",type:"",tags:"",author:""}),ee&&ee.commands.setContent(""),O(!0)},Q=e=>{q(e._id),$({title:e.title,slug:e.slug||"",content:e.content,type:e.type,tags:e.tags.map((e=>e.name)).join(", "),author:e.author||""}),ee&&ee.commands.setContent(e.content||""),O(!0)},Y=()=>{O(!1),q(null),$({title:"",slug:"",content:"",type:"",tags:"",author:""}),ee&&ee.commands.setContent("")},ee=(0,k.hG)({extensions:[b.A,w.A,S.Ay,I.Ay,W.A.configure({types:["heading","paragraph"]}),z.Ay,L.Ay,B.A.configure({levels:[1,2,3]})],content:N.content,onUpdate:e=>{let{editor:t}=e;$((e=>({...e,content:t.getHTML()})))}}),te=[{field:"title",headerName:"Title",flex:1,minWidth:120},{field:"slug",headerName:"Slug",flex:1,minWidth:120},{field:"type",headerName:"Type",flex:1,minWidth:80},{field:"tags",headerName:"Tags",flex:1,minWidth:120,renderCell:e=>e.row&&Array.isArray(e.row.tags)?e.row.tags.map((e=>e&&e.name?e.name:"")).filter(Boolean).join(", "):""},{field:"author",headerName:"Author",flex:1,minWidth:120},{field:"actions",headerName:"Actions",flex:1,minWidth:160,sortable:!1,renderCell:e=>(0,X.jsxs)(X.Fragment,{children:[(0,X.jsx)(s.A,{variant:"outlined",size:"small",onClick:()=>Q(e.row),sx:{mr:1,display:{xs:"none",sm:"inline-flex"}},children:"Edit"}),(0,X.jsx)(s.A,{variant:"outlined",color:"error",size:"small",onClick:()=>M(e.row._id),sx:{display:{xs:"none",sm:"inline-flex"}},children:"Delete"}),(0,X.jsx)(a.A,{size:"small",onClick:()=>Q(e.row),sx:{display:{xs:"inline-flex",sm:"none"}},children:(0,X.jsx)(y.A,{})}),(0,X.jsx)(a.A,{size:"small",color:"error",onClick:()=>M(e.row._id),sx:{display:{xs:"inline-flex",sm:"none"}},children:(0,X.jsx)(v.A,{})})]})}];return(0,X.jsxs)(r.A,{children:[(0,X.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,X.jsx)(o.A,{variant:"h5",sx:{fontSize:{xs:"1.4rem",sm:"2rem"},fontWeight:700},children:"Manage Posts"}),(0,X.jsx)(s.A,{variant:"contained",startIcon:(0,X.jsx)(C.A,{}),onClick:K,sx:{display:{xs:"none",sm:"flex"}},children:"Add Post"}),(0,X.jsx)(a.A,{color:"primary",onClick:K,sx:{display:{xs:"flex",sm:"none"}},children:(0,X.jsx)(C.A,{})})]}),i?(0,X.jsx)(c.A,{}):T?(0,X.jsx)(d.A,{severity:"error",children:T}):(0,X.jsx)(r.A,{sx:{width:"100%",maxWidth:"100vw",overflowX:"auto"},children:(0,X.jsx)(f.z,{autoHeight:!0,rows:e.filter((e=>e&&"object"===typeof e&&e._id)).map((e=>({...e,id:e._id}))),columns:te,pageSize:10,rowsPerPageOptions:[5,10,20,100],sx:{minWidth:320,maxWidth:"100vw",bgcolor:"background.paper",color:"text.primary",borderRadius:2},disableSelectionOnClick:!0})}),(0,X.jsxs)(h.A,{open:F,onClose:Y,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"80vh",maxHeight:"90vh"}},children:[(0,X.jsx)(u.A,{children:U?"Edit Post":"Add New Post"}),(0,X.jsx)(x.A,{dividers:!0,children:(0,X.jsx)("form",{onSubmit:J,style:{width:"100%"},children:(0,X.jsxs)(A.A,{direction:"column",spacing:3,alignItems:"stretch",sx:{width:"100%",overflow:"visible"},children:[(0,X.jsx)(g.A,{name:"title",label:"Title *",value:N.title,onChange:G,required:!0,size:"small",variant:"outlined",fullWidth:!0}),(0,X.jsx)(g.A,{name:"slug",label:"Slug *",value:N.slug,onChange:G,required:!0,size:"small",variant:"outlined",fullWidth:!0}),(0,X.jsx)(g.A,{name:"type",label:"Type *",value:N.type,onChange:G,required:!0,size:"small",variant:"outlined",fullWidth:!0}),(0,X.jsx)(g.A,{name:"tags",label:"Tags (comma separated)",value:N.tags,onChange:G,size:"small",variant:"outlined",fullWidth:!0}),(0,X.jsx)(g.A,{name:"author",label:"Author *",value:N.author,onChange:G,required:!0,size:"small",variant:"outlined",fullWidth:!0}),(0,X.jsxs)(r.A,{sx:{border:`1px solid ${D.palette.divider}`,borderRadius:2,bgcolor:"background.paper",p:0,minHeight:160,overflow:"visible","& .tiptap":{minHeight:120,outline:"none",bgcolor:"background.paper",color:"text.primary"}},children:[(0,X.jsx)(Z,{editor:ee}),(0,X.jsx)(k.$Z,{editor:ee,className:"tiptap"})]})]})})}),(0,X.jsxs)(p.A,{children:[(0,X.jsx)(s.A,{onClick:Y,children:"Cancel"}),(0,X.jsx)(s.A,{onClick:J,variant:"contained",disabled:!N.title||!N.type||!N.author,children:U?"Update":"Create"})]})]}),(0,X.jsx)(j.A,{open:R.open,autoHideDuration:3e3,onClose:()=>_({...R,open:!1}),children:(0,X.jsx)(d.A,{onClose:()=>_({...R,open:!1}),severity:R.severity,sx:{width:"100%"},children:R.message})})]})}}}]);
//# sourceMappingURL=883.21fefe19.chunk.js.map